<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Occident - Cart - Polar Sound 2026</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
    :root {
      --color-primary: #0079ca;
      --color-text: #031419;
      --color-text-secondary: #536b75;
      --color-border: #E6EAEE;
      --color-bg: #ffffff;
      --color-bg-neutral: #F5F7F9;
      --font: 'Montserrat', sans-serif;
    }
    html { scroll-behavior: smooth; -webkit-tap-highlight-color: transparent; }
    body { font-family:var(--font); background:var(--color-bg-neutral); display:flex; justify-content:center; color:var(--color-text); overflow-x:hidden; }
    .phone { width:393px; max-width:100vw; background:var(--color-bg); min-height:100vh; position:relative; padding-bottom:100px; }

    .sticky-header { position:sticky; top:0; z-index:100; background:#fff; }
    .navbar { display:flex; align-items:center; justify-content:space-between; padding:10px 16px; background:#fff; border-top:none; border-bottom:1px solid #e6eaee; }
    .navbar .logo-link { text-decoration:none; display:flex; align-items:center; }
    .navbar .logo-link img { height:38px; width:auto; display:block; object-fit:contain; }
    .nav-icons { display:flex; align-items:center; gap:16px; }
    .nav-icons svg { width:24px; height:24px; color:var(--color-text); cursor:pointer; }
    .nav-icon-btn { margin:0; padding:0; border:none; background:none; display:inline-flex; align-items:center; justify-content:center; cursor:pointer; text-decoration:none; color:inherit; }
    .nav-icon-btn svg { width:24px; height:24px; color:var(--color-text); }
    .avatar-wrap { position:relative; display:flex; align-items:center; }
    .avatar-wrap img { width:24px; height:24px; border-radius:50%; object-fit:cover; }
    .avatar-wrap::after { content:''; position:absolute; top:-1px; right:-1px; width:8px; height:8px; background:#22ad5c; border:1.5px solid white; border-radius:50%; }

    .event-summary { display:flex; gap:12px; padding:16px; align-items:center; border-bottom:1px solid var(--color-border); }
    .event-summary .event-thumb { width:56px; height:56px; border-radius:8px; overflow:hidden; flex-shrink:0; }
    .event-summary .event-thumb img { width:100%; height:100%; object-fit:cover; }
    .event-summary .event-info { flex:1; }
    .event-summary .event-name { font-size:14px; font-weight:600; line-height:20px; margin-bottom:2px; }
    .event-summary .event-venue { font-size:12px; color:var(--color-text-secondary); display:flex; align-items:center; gap:4px; }
    .event-summary .event-venue svg { width:12px; height:12px; flex-shrink:0; }

    .cart-section { padding:12px 16px; border-bottom:1px solid var(--color-border); }
    .cart-section h3 { font-size:16px; font-weight:700; margin-bottom:8px; }
    .cart-item { display:flex; justify-content:space-between; align-items:center; padding:8px 0; border-bottom:1px solid var(--color-border); gap:12px; }
    .cart-item:last-child { border-bottom:none; }
    .cart-item .item-info { flex:1; }
    .cart-item .item-name { font-size:14px; font-weight:500; margin-bottom:2px; }
    .cart-item .item-detail { font-size:12px; color:var(--color-text-secondary); }
    .cart-item .item-row { display:flex; align-items:center; gap:8px; margin-top:4px; }
    .cart-item .qty-wrap { display:flex; align-items:center; border:1px solid var(--color-border); border-radius:8px; overflow:hidden; }
    .cart-item .qty-wrap button { width:36px; height:32px; border:none; background:var(--color-bg-neutral); font-size:18px; cursor:pointer; line-height:1; display:inline-flex; align-items:center; justify-content:center; flex-shrink:0; }
    .cart-item .qty-wrap button svg { width:16px; height:16px; display:block; stroke:currentColor; }
    .cart-item .qty-wrap input { width:36px; border:none; text-align:center; font-size:14px; font-weight:600; padding:0; background:transparent; -moz-appearance:textfield; }
    .cart-item .qty-wrap input::-webkit-outer-spin-button,
    .cart-item .qty-wrap input::-webkit-inner-spin-button { -webkit-appearance:none; margin:0; }
    .cart-item .item-price { font-size:14px; font-weight:600; }
    .cart-item .btn-remove { background:none; border:none; color:var(--color-text-secondary); cursor:pointer; padding:0; width:20px; height:20px; display:inline-flex; align-items:center; justify-content:center; }
    .cart-item .btn-remove svg { width:16px; height:16px; display:block; stroke:currentColor; }

    .cart-total { padding:16px; font-size:16px; font-weight:700; display:flex; justify-content:space-between; }
    .empty-state-row { display: flex; align-items: center; justify-content: space-between; gap: 12px; }
    .empty-state-text { font-size:14px; color:var(--color-text-secondary); }
    .empty-state-link {
      display:inline-flex;
      align-items:center;
      justify-content:center;
      text-decoration:none;
      white-space:nowrap;
      border:1px solid #BFD9EF;
      color:var(--color-primary);
      background:#F3FAFF;
      border-radius:999px;
      padding:6px 10px;
      font-size:12px;
      font-weight:600;
      line-height:16px;
    }
    .sticky-cta { position:fixed; bottom:0; width:393px; max-width:100vw; z-index:200; background:transparent; padding:12px 16px; }
    .sticky-cta .cta-btn { display:block; width:100%; height:48px; background:#0079ca; border:2px solid transparent; border-radius:64px; color:#fff; font-family:var(--font); font-weight:600; font-size:16px; line-height:24px; cursor:pointer; transition:background 0.2s, border-color 0.2s, box-shadow 0.2s, color 0.2s, opacity 0.2s; outline:none; }
    .sticky-cta .cta-btn:hover { background:#0079ca; }
    .sticky-cta .cta-btn:focus-visible { border-color:#005795; box-shadow:0 0 0 4px rgba(0,121,202,0.32); }
    .sticky-cta .cta-btn:active { background:#0079ca; }
    .sticky-cta .cta-btn:disabled, .sticky-cta .cta-btn.disabled { background:#f2f3f3; color:#a7b2ba; border-color:transparent; box-shadow:none; cursor:default; opacity:1; }
  </style>
</head>
<body>
  <div class="phone">
    <header class="sticky-header">
    <nav class="navbar">
      <a href="index.html" class="logo-link"><img src="../img/fever-logo.png" alt="Fever"></a>
      <div class="nav-icons">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><circle cx="10.5" cy="10.5" r="7"/><line x1="15.5" y1="15.5" x2="22" y2="22"/></svg>
        <a class="nav-icon-btn" href="../favorites.html" aria-label="Favorites"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg></a>
        <a class="nav-icon-btn" href="index.html" aria-label="Location"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/><circle cx="12" cy="9" r="2.5"/></svg></a>
        <a class="avatar-wrap" href="../profile.html" aria-label="Profile"><img src="https://www.figma.com/api/mcp/asset/541291f3-2b10-4d67-b843-70a0add86fab" alt="Profile"></a>
        <a class="nav-icon-btn" href="index.html" aria-label="Menu"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg></a>
      </div>
    </nav>
    </header>

    <div class="event-summary">
      <div class="event-thumb">
        <img src="../img/polar-sound-hero.png" alt="Polar Sound Festival">
      </div>
      <div class="event-info">
        <div class="event-name">Occident - Polar Sound 2026</div>
        <div class="event-venue">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/><circle cx="12" cy="9" r="2.5"/></svg>
          Baqueira Beret Ski Resort
        </div>
      </div>
    </div>

    <div class="date-row" style="padding:16px; border-bottom:1px solid var(--color-border);">
      <div class="label" style="font-size:14px; font-weight:700; color:#0079ca; margin-bottom:4px;">Date</div>
      <div class="value" style="font-size:14px;">March 13 &amp; 14, 2026</div>
    </div>

    <div class="cart-section" id="section-tickets">
      <h3>Festival Passes</h3>
      <div id="ticket-items"></div>
    </div>
    <div class="cart-section" id="section-accommodation">
      <h3>Accommodation</h3>
      <div id="accommodation-items"></div>
    </div>
    <div class="cart-section" id="section-transportation">
      <h3>Transportation</h3>
      <div id="transportation-items"></div>
    </div>

    <div class="cart-total">
      <span>Total</span>
      <span id="cart-grand-total">&euro;0.00</span>
    </div>
    <div class="sticky-cta">
      <button type="button" class="cta-btn" id="btn-checkout">Proceed to checkout</button>
    </div>
  </div>

  <script src="../js/burger-menu.js"></script>
  <script>
    let cartTickets = [];
    let cartAccommodation = [];
    let cartTransportation = [];

    function loadCart() {
      try {
        cartTickets = JSON.parse(localStorage.getItem('cart_tickets') || '[]');
        cartAccommodation = JSON.parse(localStorage.getItem('cart_accommodation') || '[]');
        cartTransportation = JSON.parse(localStorage.getItem('cart_transportation') || '[]');
      } catch (e) {
        cartTickets = [];
        cartAccommodation = [];
        cartTransportation = [];
      }
    }

    function saveCart() {
      localStorage.setItem('cart_tickets', JSON.stringify(cartTickets));
      localStorage.setItem('cart_accommodation', JSON.stringify(cartAccommodation));
      localStorage.setItem('cart_transportation', JSON.stringify(cartTransportation));
    }

    function renderItem(item, index, type) {
      const div = document.createElement('div');
      div.className = 'cart-item';
      div.dataset.type = type;
      div.dataset.index = index;
      const qty = item.qty != null ? item.qty : 1;
      const price = (parseFloat(String(item.price).replace(/[^\d.,]/g, '').replace(',', '.')) || 0) * qty;
      div.innerHTML = '<div class="item-info"><div class="item-name">' + (item.name || 'Item') + '</div>' +
        (item.detail ? '<div class="item-detail">' + item.detail + '</div>' : '') +
        '<div class="item-row"><div class="qty-wrap"><button type="button" aria-label="Less">−</button><input type="number" min="0" value="' + qty + '" aria-label="Quantity"><button type="button" aria-label="More">+</button></div></div></div>' +
        '<div class="item-price">€' + price.toFixed(2) + '</div>' +
        '<button type="button" class="btn-remove" aria-label="Remove item">' +
          '<svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">' +
            '<path d="M3 6h18"/><path d="M8 6V4h8v2"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6"/><path d="M14 11v6"/>' +
          '</svg>' +
        '</button>';
      const qtyInput = div.querySelector('input');
      const lessBtn = div.querySelector('.qty-wrap button:first-child');
      const moreBtn = div.querySelector('.qty-wrap button:last-child');
      const removeBtn = div.querySelector('.btn-remove');
      function removeCurrentItem() {
        if (type === 'tickets') cartTickets.splice(index, 1);
        else if (type === 'accommodation') cartAccommodation.splice(index, 1);
        else cartTransportation.splice(index, 1);
        saveCart();
        render();
      }
      function syncLessButtonState() {
        const arr = type === 'tickets' ? cartTickets : type === 'accommodation' ? cartAccommodation : cartTransportation;
        const qty = Math.max(0, (arr[index] && arr[index].qty != null ? arr[index].qty : 1));
        if (qty <= 0) {
          lessBtn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M3 6h18"/><path d="M8 6V4h8v2"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6"/><path d="M14 11v6"/></svg>';
          lessBtn.setAttribute('aria-label', 'Remove item');
        } else {
          lessBtn.innerHTML = '−';
          lessBtn.setAttribute('aria-label', 'Less');
        }
      }
      function updateQty(delta) {
        const arr = type === 'tickets' ? cartTickets : type === 'accommodation' ? cartAccommodation : cartTransportation;
        const currentQty = Math.max(0, (arr[index] && arr[index].qty != null ? arr[index].qty : 1));
        if (delta < 0 && currentQty <= 0) {
          removeCurrentItem();
          return;
        }
        arr[index].qty = Math.max(0, currentQty + delta);
        saveCart();
        render();
      }
      lessBtn.addEventListener('click', () => updateQty(-1));
      moreBtn.addEventListener('click', () => updateQty(1));
      qtyInput.addEventListener('change', function() {
        const v = parseInt(this.value, 10);
        if (!isNaN(v) && v >= 0) {
          const arr = type === 'tickets' ? cartTickets : type === 'accommodation' ? cartAccommodation : cartTransportation;
          arr[index].qty = v;
          saveCart();
          render();
        }
      });
      removeBtn.addEventListener('click', removeCurrentItem);
      syncLessButtonState();
      return div;
    }

    function getTotal() {
      let t = 0;
      cartTickets.forEach(item => {
        const p = parseFloat(String(item.price).replace(/[^\d.,]/g, '').replace(',', '.')) || 0;
        t += p * (item.qty || 1);
      });
      cartAccommodation.forEach(item => {
        const p = parseFloat(String(item.price).replace(/[^\d.,]/g, '').replace(',', '.')) || 0;
        t += p * (item.qty || 1);
      });
      cartTransportation.forEach(item => {
        const p = parseFloat(String(item.price).replace(/[^\d.,]/g, '').replace(',', '.')) || 0;
        t += p * (item.qty || 1);
      });
      return t;
    }

    function hasAnyCartItems() {
      function hasItems(arr) {
        return arr.some(function(item) { return (item && (item.qty || 1) > 0); });
      }
      return hasItems(cartTickets) || hasItems(cartAccommodation) || hasItems(cartTransportation);
    }

    function renderEmptyState(message, ctaText, href) {
      return '<div class="empty-state-row"><a class="empty-state-link" href="' + href + '">' + ctaText + '</a></div>';
    }

    function render() {
      const ticketContainer = document.getElementById('ticket-items');
      const accomContainer = document.getElementById('accommodation-items');
      const transportContainer = document.getElementById('transportation-items');
      ticketContainer.innerHTML = '';
      accomContainer.innerHTML = '';
      transportContainer.innerHTML = '';
      cartTickets.forEach((item, i) => ticketContainer.appendChild(renderItem(item, i, 'tickets')));
      cartAccommodation.forEach((item, i) => accomContainer.appendChild(renderItem(item, i, 'accommodation')));
      cartTransportation.forEach((item, i) => transportContainer.appendChild(renderItem(item, i, 'transportation')));
      if (cartTickets.length === 0) ticketContainer.innerHTML = renderEmptyState('', 'Add', 'polar-sound.html#ticket-section');
      if (cartAccommodation.length === 0) accomContainer.innerHTML = renderEmptyState('', 'Add', 'polar-sound-accommodation.html');
      if (cartTransportation.length === 0) transportContainer.innerHTML = renderEmptyState('', 'Add', '../polar-sound-transportations.html?flow=option-b');
      document.getElementById('cart-grand-total').textContent = '€' + getTotal().toFixed(2);
    }

    loadCart();
    render();

    document.getElementById('btn-checkout').addEventListener('click', function() {
      if (!hasAnyCartItems()) {
        window.location.href = 'polar-sound.html#ticket-section';
        return;
      }
      try { sessionStorage.setItem('checkout_scroll_target', 'payment'); } catch (e) {}
      window.location.href = 'checkout.html';
    });
  </script>
</body>
</html>
