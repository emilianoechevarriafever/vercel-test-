<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" type="image/png" sizes="32x32" href="../../../favicons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../../../favicons/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="../../../favicons/apple-touch-icon.png">
  <link rel="shortcut icon" href="../../../favicon.ico">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Occident - Cart - Polar Sound 2026</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
    :root {
      --color-primary: #0079ca;
      --color-text: #031419;
      --color-text-subtle: #536b75;
      --color-border: #ccd2d8;
      --color-bg: #ffffff;
      --color-bg-neutral: #f2f3f3;
      --font: 'Montserrat', sans-serif;
    }
    html { scroll-behavior: smooth; -webkit-tap-highlight-color: transparent; }
    body { font-family:var(--font); background:var(--color-bg-neutral); display:flex; justify-content:center; color:var(--color-text); overflow-x:hidden; }
    .phone { width:393px; max-width:100vw; background:var(--color-bg); min-height:100vh; position:relative; padding-bottom:100px; }

    .sticky-header { position:sticky; top:0; z-index:100; background:#fff; }
    .navbar { display:flex; align-items:center; justify-content:space-between; padding:10px 16px; background:#fff; border-top:none; border-bottom:1px solid #ccd2d8; }
    .navbar .logo-link { text-decoration:none; display:flex; align-items:center; }
    .navbar .logo-link img { height:38px; width:auto; display:block; object-fit:contain; }
    .nav-icons { display:flex; align-items:center; gap:20px; }
    .nav-icons svg { height:24px; width:auto; color:var(--color-text); cursor:pointer; }
    .nav-icon-btn{all:unset;display:inline-flex;align-items:center;justify-content:center;cursor:pointer;color:inherit;width:24px;height:24px;flex-shrink:0;box-sizing:border-box;overflow:visible}
    .nav-icon-btn svg { height:24px; width:auto; color:var(--color-text); }
    .avatar-wrap{all:unset;position:relative;display:inline-flex;align-items:center;justify-content:center;cursor:pointer;width:24px;height:24px;flex-shrink:0;box-sizing:border-box}
    .avatar-wrap img { width:24px; height:24px; border-radius:50%; object-fit:cover; display:none;}
    .avatar-wrap .avatar-placeholder { display:flex;}
    html.u-in .avatar-wrap::after { content:''; position:absolute; top:-1px; right:-1px; width:8px; height:8px; background:#22ad5c; border:1.5px solid white; border-radius:50%; }
    html.u-in .avatar-wrap img{display:block}
    html.u-in .avatar-wrap .avatar-placeholder{display:none}
    .event-summary { display:flex; gap:12px; padding:16px; align-items:center; border-bottom:1px solid var(--color-border); }
    .event-summary .event-thumb { width:56px; height:56px; border-radius:8px; overflow:hidden; flex-shrink:0; }
    .event-summary .event-thumb img { width:100%; height:100%; object-fit:cover; }
    .event-summary .event-info { flex:1; }
    .event-summary .event-name { font-size:14px; font-weight:600; line-height:20px; margin-bottom:2px; }
    .event-summary .event-venue { font-size:12px; color:var(--color-text-subtle); display:flex; align-items:center; gap:4px; }
    .event-summary .event-venue svg { width:12px; height:12px; flex-shrink:0; }

    .cart-section { padding:12px 16px; border-bottom:1px solid var(--color-border); }
    .section-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:4px; }
    .section-header h3 { font-size:16px; font-weight: 600; margin:0; }
    .section-header .empty-state-link { margin:0; }

    .swipe-container { position:relative; overflow:hidden; border-bottom:1px solid var(--color-border); }
    .swipe-container:last-child { border-bottom:none; }
    .swipe-delete { position:absolute; top:0; right:0; bottom:0; width:80px; background:#eb0052; display:none; align-items:center; justify-content:center; color:#fff; }
    .swipe-container.active-swipe .swipe-delete { display:flex; }
    .swipe-delete svg { width:22px; height:22px; stroke:#fff; fill:none; stroke-width:1.8; stroke-linecap:round; stroke-linejoin:round; }
    .swipe-inner { position:relative; background:#fff; z-index:1; transition:transform 0.2s ease; }
    .swipe-inner.swiping { transition:none; }

    .cart-item { display:flex; align-items:flex-start; justify-content:space-between; gap:12px; padding:10px 0; }
    .cart-item .item-left { flex:1; min-width:0; }
    .cart-item .item-name { font-size:14px; font-weight:500; margin-bottom:2px; }
    .cart-item .item-detail { font-size:12px; color:var(--color-text-subtle); margin-bottom:4px; }
    .cart-item .item-price { font-size:14px; font-weight:600; margin-top:4px; }
    .cart-item .qty-wrap { display:flex; align-items:center; gap:4px; }
    .cart-item .qty-wrap button { width:32px; height:32px; border:none; border-radius:50%; font-size:18px; cursor:pointer; line-height:1; display:inline-flex; align-items:center; justify-content:center; flex-shrink:0; transition:background 0.15s, color 0.15s; }
    .cart-item .qty-wrap button svg { width:16px; height:16px; stroke:currentColor; fill:none; display:block; }
    .cart-item .qty-wrap button:first-child { background:#f2f3f3; color:#a7b2ba; }
    .cart-item .qty-wrap button:last-child { background:#e6f4ff; color:#0079ca; }
    .cart-item .qty-wrap input { width:36px; border:none; text-align:center; font-size:16px; font-weight:600; padding:0; background:transparent; color:#031419; -moz-appearance:textfield; }
    .cart-item .qty-wrap input::-webkit-outer-spin-button,
    .cart-item .qty-wrap input::-webkit-inner-spin-button { -webkit-appearance:none; margin:0; }

    .cart-total { padding:16px; font-size:16px; font-weight: 600; display:flex; justify-content:space-between; }
    .empty-state-row { display:none; }
    .empty-state-link {
      display:inline-flex;
      align-items:center;
      justify-content:center;
      text-decoration:none;
      white-space:nowrap;
      border:1px solid #BFD9EF;
      color:var(--color-primary);
      background:#F3FAFF;
      border-radius:64px;
      padding:6px 14px;
      font-size:14px;
      font-weight:600;
      line-height:16px;
      cursor:pointer;
      font-family:var(--font);
    }
    .sticky-cta { position:fixed; bottom:0; width:393px; max-width:100vw; z-index:200; background:transparent; padding:12px 16px max(12px, env(safe-area-inset-bottom)); }
    .sticky-cta .cta-btn { display:block; width:100%; height:48px; background:#0079ca; border:2px solid transparent; border-radius:64px; color:#fff; font-family:var(--font); font-weight:600; font-size:16px; line-height:24px; cursor:pointer; transition:background 0.2s, border-color 0.2s, box-shadow 0.2s, color 0.2s, opacity 0.2s; outline:none; }
    .sticky-cta .cta-btn:hover { background:#0079ca; }
    .sticky-cta .cta-btn:focus-visible { border-color:#005795; box-shadow:0 0 0 4px rgba(0,121,202,0.32); }
    .sticky-cta .cta-btn:active { background:#0079ca; }
    .sticky-cta .cta-btn:disabled, .sticky-cta .cta-btn.disabled { background:#f2f3f3; color:#a7b2ba; border-color:transparent; box-shadow:none; cursor:default; opacity:1; }
    /* === BOTTOM SHEETS === */
    .sheet-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.4); z-index:400; opacity:0; visibility:hidden; transition:opacity 0.25s, visibility 0.25s; }
    .sheet-overlay.open { opacity:1; visibility:visible; }
    .sheet { position:fixed; left:50%; transform:translateX(-50%) translateY(100%); bottom:0; width:393px; max-width:100vw; max-height:75vh; background:white; border-radius:16px 16px 0 0; z-index:401; transition:transform 0.3s ease; box-shadow:0 -4px 20px rgba(0,0,0,0.15); display:flex; flex-direction:column; }
    .sheet.open { transform:translateX(-50%) translateY(0); }
    .sheet .sheet-handle { width:36px; height:4px; background:#ddd; border-radius:4px; margin:12px auto 0; flex-shrink:0; }
    .sheet .sheet-header { display:flex; align-items:center; justify-content:center; position:relative; padding:8px 48px 16px; }
    .sheet .sheet-title { font-size:18px; font-weight: 600; color:var(--color-text); text-align:center; }
    .sheet .sheet-close { position:absolute; right:16px; top:50%; transform:translateY(-50%); width:32px; height:32px; border:none; background:none; cursor:pointer; display:flex; align-items:center; justify-content:center; padding:0; color:var(--color-text-subtle); }
    .sheet .sheet-close svg { width:20px; height:20px; }
    .sheet .sheet-content { padding:0 16px; overflow-y:auto; flex:1; min-height:0; }
    .sheet .sheet-footer { padding:16px; border-top:1px solid var(--color-border); flex-shrink:0; }
    .sheet .sheet-footer .sheet-btn { width:100%; height:48px; border-radius:64px; font-family:var(--font); font-weight:600; font-size:16px; cursor:pointer; border:none; }
    .sheet .sheet-footer .sheet-btn-primary { background:#0079ca; color:white; }
    .sheet .sheet-row { display:flex; align-items:stretch; min-height:72px; margin-bottom:12px; position:relative; border-radius:16px; border:1.5px solid var(--color-border-light,#ccd2d8); }
    .sheet .sheet-row .sheet-row-content { flex:1; padding:12px; display:flex; flex-direction:column; justify-content:center; gap:2px; border-right:none; border-radius:16px 0 0 16px; }
    .sheet .sheet-row .sheet-row-name { font-size:14px; font-weight:600; line-height:18px; color:var(--color-text); }
    .sheet .sheet-row .sheet-row-price { font-size:14px; font-weight:600; color:var(--color-text); }
    .sheet .sheet-row .sheet-row-right { width:100px; flex-shrink:0; display:flex; align-items:center; justify-content:center; padding:8px 12px 8px 4px; }
    .sheet .sheet-row .sheet-stepper { display:flex; align-items:center; gap:4px; padding:0; background:transparent; border:none; }
    .sheet .sheet-row .sheet-stepper .amt-btn { width:28px; height:28px; border-radius:50%; border:1px solid var(--color-border-light,#ccd2d8); background:white; display:flex; align-items:center; justify-content:center; cursor:pointer; font-size:16px; font-weight:400; color:var(--color-text); }
    .sheet .sheet-row .sheet-stepper .amt-count { width:28px; text-align:center; font-size:14px; font-weight:600; }
    .sheet .sheet-row.selected { border-color:#0079ca; }
    .sheet .sheet-row.selected .sheet-row-content { background:#e6f4ff; }
    .sheet .sheet-row.selected .sheet-row-right { background:#e6f4ff; border-radius:0 16px 16px 0; padding:8px 12px 8px 4px; }
    .sheet .sheet-row.selected .sheet-stepper { background:#fff; border-radius:64px; padding:4px 6px; }
    .sheet .sheet-row.selected .sheet-stepper .amt-btn { background:#e6f4ff; color:#0079ca; border:none; }
    @media (max-width:393px) { .sheet { width:100vw; } }

    /* Focus-visible */
    button:focus-visible, a:focus-visible { outline: 2px solid #0079ca; outline-offset: 2px; }
    /* Tap feedback */
    .nav-icon-btn:active { opacity:0.6; }
    .ticket-pill:active { transform:scale(0.96); }
  </style>
  <link rel="stylesheet" href="../../../css/navbar.css">
<script>if(localStorage.getItem("fever_logged_in")==="true")document.documentElement.classList.add("u-in")</script>
</head>
<body>
  <div class="phone">
    <header class="sticky-header">
    <nav class="navbar">
      <a href="index.html" class="logo-link"><img src="../img/fever-logo.svg" alt="Fever"></a>
      <div class="nav-icons">
        <a class="nav-icon-btn" href="../../../search.html" aria-label="Search"><svg viewBox="0 0 512 512" fill="currentColor"><path d="M384 208A176 176 0 1 0 32 208a176 176 0 1 0 352 0zM343.3 366C307 397.2 259.7 416 208 416C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208c0 51.7-18.8 99-50 135.3L507.3 484.7c6.2 6.2 6.2 16.4 0 22.6s-16.4 6.2-22.6 0L343.3 366z"/></svg></a>
        <a class="nav-icon-btn" href="index.html" aria-label="Location"><svg viewBox="0 0 384 512" fill="currentColor"><path d="M352 192c0-88.4-71.6-160-160-160S32 103.6 32 192c0 15.6 5.4 37 16.6 63.4c10.9 25.9 26.2 54 43.6 82.1c34.1 55.3 74.4 108.2 99.9 140c25.4-31.8 65.8-84.7 99.9-140c17.3-28.1 32.7-56.3 43.6-82.1C346.6 229 352 207.6 352 192zm32 0c0 87.4-117 243-168.3 307.2c-12.3 15.3-35.1 15.3-47.4 0C117 435 0 279.4 0 192C0 86 86 0 192 0S384 86 384 192zm-240 0a48 48 0 1 0 96 0 48 48 0 1 0 -96 0zm48 80a80 80 0 1 1 0-160 80 80 0 1 1 0 160z"/></svg></a>
        <a class="nav-icon-btn" href="../favorites.html" aria-label="Favorites"><svg viewBox="0 0 512 512" fill="currentColor"><path d="M244 130.6l-12-13.5-4.2-4.7c-26-29.2-65.3-42.8-103.8-35.8c-53.3 9.7-92 56.1-92 110.3v3.5c0 32.3 13.4 63.1 37.1 85.1L253 446.8c.8 .7 1.9 1.2 3 1.2s2.2-.4 3-1.2L443 275.5c23.6-22 37-52.8 37-85.1v-3.5c0-54.2-38.7-100.6-92-110.3c-38.5-7-77.8 6.6-103.8 35.8l-4.2 4.7-12 13.5c-3 3.4-7.4 5.4-12 5.4s-8.9-2-12-5.4zm34.9-57.1C311 48.4 352.7 37.7 393.7 45.1C462.2 57.6 512 117.3 512 186.9v3.5c0 36-13.1 70.6-36.6 97.5c-3.4 3.8-6.9 7.5-10.7 11l-184 171.3c-.8 .8-1.7 1.5-2.6 2.2c-6.3 4.9-14.1 7.5-22.1 7.5c-9.2 0-18-3.5-24.8-9.7L47.2 299c-3.8-3.5-7.3-7.2-10.7-11C13.1 261 0 226.4 0 190.4v-3.5C0 117.3 49.8 57.6 118.3 45.1c40.9-7.4 82.6 3.2 114.7 28.4c6.7 5.3 13 11.1 18.7 17.6l4.2 4.7 4.2-4.7c4.2-4.7 8.6-9.1 13.3-13.1c1.8-1.5 3.6-3 5.4-4.5z"/></svg></a>
        <a class="avatar-wrap" href="../profile.html" aria-label="Profile"><img src="../../../img/profile-avatar.png" alt="Profile"></a>
<a class="nav-icon-btn" href="../../../category.html" aria-label="Menu"><svg viewBox="0 0 448 512" fill="currentColor"><path d="M0 80c0-8.8 7.2-16 16-16H432c8.8 0 16 7.2 16 16s-7.2 16-16 16H16C7.2 96 0 88.8 0 80zM0 240c0-8.8 7.2-16 16-16H432c8.8 0 16 7.2 16 16s-7.2 16-16 16H16c-8.8 0-16-7.2-16-16zM448 400c0 8.8-7.2 16-16 16H16c-8.8 0-16-7.2-16-16s7.2-16 16-16H432c8.8 0 16 7.2 16 16z"/></svg></a>
      </div>
    </nav>
    </header>

    <div class="event-summary">
      <div class="event-thumb">
        <img src="../img/polar-sound-hero.png" alt="Polar Sound Festival">
      </div>
      <div class="event-info">
        <div class="event-name">Occident - Polar Sound 2026</div>
        <div class="event-venue">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/><circle cx="12" cy="9" r="2.5"/></svg>
          Baqueira Beret Ski Resort
        </div>
      </div>
    </div>

    <div class="date-row" style="padding:16px; border-bottom:1px solid var(--color-border);">
      <div class="label" style="font-size:14px; font-weight: 600; color:#0079ca; margin-bottom:4px;">Date</div>
      <div class="value" style="font-size:14px;">March 13 &amp; 14, 2026</div>
    </div>

    <div class="cart-section" id="section-tickets">
      <div class="section-header"><h3>Festival Passes</h3><span id="ticket-add-btn"></span></div>
      <div id="ticket-items"></div>
    </div>
    <div class="cart-section" id="section-accommodation">
      <div class="section-header"><h3>Hotel</h3><span id="accommodation-add-btn"></span></div>
      <div id="accommodation-items"></div>
    </div>
    <div class="cart-section" id="section-transportation">
      <div class="section-header"><h3>Transportation</h3><span id="transportation-add-btn"></span></div>
      <div id="transportation-items"></div>
    </div>

    <div class="cart-total">
      <span>Total</span>
      <span id="cart-grand-total">&euro;0.00</span>
    </div>
    <div class="sticky-cta">
      <button type="button" class="cta-btn" id="btn-checkout">Proceed to checkout</button>
    </div>
  </div>

  <!-- Bottom sheet: Hotel -->
  <div class="sheet-overlay" id="overlay-sheet-acc"></div>
  <div class="sheet" id="sheet-acc">
    <div class="sheet-handle"></div>
    <div class="sheet-header">
      <h2 class="sheet-title">Hotel</h2>
      <button type="button" class="sheet-close" id="sheet-acc-close" aria-label="Close"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button>
    </div>
    <div class="sheet-content">
      <div class="sheet-row" data-name="Hotel 2 nights" data-price="120">
        <div class="sheet-row-content">
          <div class="sheet-row-name">Hotel 2 nights</div>
          <div class="sheet-row-price">&euro;120.00</div>
        </div>
        <div class="sheet-row-right">
          <div class="sheet-stepper">
            <button type="button" class="amt-btn minus">&minus;</button>
            <span class="amt-count">0</span>
            <button type="button" class="amt-btn plus">+</button>
          </div>
        </div>
      </div>
      <div class="sheet-row" data-name="Apartment 2 nights" data-price="90">
        <div class="sheet-row-content">
          <div class="sheet-row-name">Apartment 2 nights</div>
          <div class="sheet-row-price">&euro;90.00</div>
        </div>
        <div class="sheet-row-right">
          <div class="sheet-stepper">
            <button type="button" class="amt-btn minus">&minus;</button>
            <span class="amt-count">0</span>
            <button type="button" class="amt-btn plus">+</button>
          </div>
        </div>
      </div>
    </div>
    <div class="sheet-footer">
      <button type="button" class="sheet-btn sheet-btn-primary" id="sheet-acc-confirm">Skip hotel</button>
    </div>
  </div>

  <!-- Bottom sheet: Transport -->
  <div class="sheet-overlay" id="overlay-sheet-transport"></div>
  <div class="sheet" id="sheet-transport">
    <div class="sheet-handle"></div>
    <div class="sheet-header">
      <h2 class="sheet-title">Transport</h2>
      <button type="button" class="sheet-close" id="sheet-transport-close" aria-label="Close"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button>
    </div>
    <div class="sheet-content">
      <div class="sheet-row" data-name="Bus Barcelona – Baqueira" data-price="49">
        <div class="sheet-row-content">
          <div class="sheet-row-name">Bus Barcelona – Baqueira</div>
          <div class="sheet-row-price">&euro;49.00</div>
        </div>
        <div class="sheet-row-right">
          <div class="sheet-stepper">
            <button type="button" class="amt-btn minus">&minus;</button>
            <span class="amt-count">0</span>
            <button type="button" class="amt-btn plus">+</button>
          </div>
        </div>
      </div>
      <div class="sheet-row" data-name="Shuttle Madrid – Baqueira" data-price="69">
        <div class="sheet-row-content">
          <div class="sheet-row-name">Shuttle Madrid – Baqueira</div>
          <div class="sheet-row-price">&euro;69.00</div>
        </div>
        <div class="sheet-row-right">
          <div class="sheet-stepper">
            <button type="button" class="amt-btn minus">&minus;</button>
            <span class="amt-count">0</span>
            <button type="button" class="amt-btn plus">+</button>
          </div>
        </div>
      </div>
    </div>
    <div class="sheet-footer">
      <button type="button" class="sheet-btn sheet-btn-primary" id="sheet-transport-confirm">Skip transport</button>
    </div>
  </div>

  <script src="../../../js/burger-menu.js"></script>
  <script>
    let cartTickets = [];
    let cartAccommodation = [];
    let cartTransportation = [];

    function loadCart() {
      try {
        cartTickets = JSON.parse(localStorage.getItem('cart_tickets') || '[]');
        cartAccommodation = JSON.parse(localStorage.getItem('cart_accommodation') || '[]');
        cartTransportation = JSON.parse(localStorage.getItem('cart_transportation') || '[]');
      } catch (e) {
        cartTickets = [];
        cartAccommodation = [];
        cartTransportation = [];
      }
    }

    function saveCart() {
      localStorage.setItem('cart_tickets', JSON.stringify(cartTickets));
      localStorage.setItem('cart_accommodation', JSON.stringify(cartAccommodation));
      localStorage.setItem('cart_transportation', JSON.stringify(cartTransportation));
    }

    function renderItem(item, index, type) {
      var trashSvg = '<svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M3 6h18"/><path d="M8 6V4h8v2"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6"/><path d="M14 11v6"/></svg>';
      var container = document.createElement('div');
      container.className = 'swipe-container';
      var deleteStrip = document.createElement('div');
      deleteStrip.className = 'swipe-delete';
      deleteStrip.innerHTML = trashSvg;
      container.appendChild(deleteStrip);
      var inner = document.createElement('div');
      inner.className = 'swipe-inner';
      var div = document.createElement('div');
      div.className = 'cart-item';
      div.dataset.type = type;
      div.dataset.index = index;
      var qty = item.qty != null ? item.qty : 1;
      var unitPrice = parseFloat(String(item.price).replace(/[^\d.,]/g, '').replace(',', '.')) || 0;
      var totalPrice = unitPrice * qty;
      div.innerHTML =
        '<div class="item-left">' +
          '<div class="item-name">' + (item.name || 'Item') + '</div>' +
          (item.detail ? '<div class="item-detail">' + item.detail + '</div>' : '') +
          '<div class="item-price">€' + totalPrice.toFixed(2) + '</div>' +
        '</div>' +
        '<div class="qty-wrap">' +
          '<button type="button" aria-label="Less">−</button>' +
          '<input type="number" min="0" value="' + qty + '" aria-label="Quantity">' +
          '<button type="button" aria-label="More">+</button>' +
        '</div>';
      inner.appendChild(div);
      container.appendChild(inner);
      var qtyInput = div.querySelector('input');
      var lessBtn = div.querySelector('.qty-wrap button:first-child');
      var moreBtn = div.querySelector('.qty-wrap button:last-child');
      function removeCurrentItem() {
        if (type === 'tickets') cartTickets.splice(index, 1);
        else if (type === 'accommodation') cartAccommodation.splice(index, 1);
        else cartTransportation.splice(index, 1);
        saveCart();
        render();
      }
      function syncLessButtonState() {
        var arr = type === 'tickets' ? cartTickets : type === 'accommodation' ? cartAccommodation : cartTransportation;
        var q = Math.max(0, (arr[index] && arr[index].qty != null ? arr[index].qty : 1));
        if (q <= 0) {
          lessBtn.innerHTML = trashSvg;
          lessBtn.setAttribute('aria-label', 'Remove item');
        } else {
          lessBtn.innerHTML = '−';
          lessBtn.setAttribute('aria-label', 'Less');
        }
      }
      function updateQty(delta) {
        var arr = type === 'tickets' ? cartTickets : type === 'accommodation' ? cartAccommodation : cartTransportation;
        var currentQty = Math.max(0, (arr[index] && arr[index].qty != null ? arr[index].qty : 1));
        if (delta < 0 && currentQty <= 0) { removeCurrentItem(); return; }
        arr[index].qty = Math.max(0, currentQty + delta);
        saveCart();
        render();
      }
      lessBtn.addEventListener('click', function() { updateQty(-1); });
      moreBtn.addEventListener('click', function() { updateQty(1); });
      qtyInput.addEventListener('change', function() {
        var v = parseInt(this.value, 10);
        if (!isNaN(v) && v >= 0) {
          var arr = type === 'tickets' ? cartTickets : type === 'accommodation' ? cartAccommodation : cartTransportation;
          arr[index].qty = v;
          saveCart();
          render();
        }
      });
      syncLessButtonState();
      initSwipe(container, inner, removeCurrentItem);
      return container;
    }

    function getTotal() {
      let t = 0;
      cartTickets.forEach(item => {
        const p = parseFloat(String(item.price).replace(/[^\d.,]/g, '').replace(',', '.')) || 0;
        t += p * (item.qty || 1);
      });
      cartAccommodation.forEach(item => {
        const p = parseFloat(String(item.price).replace(/[^\d.,]/g, '').replace(',', '.')) || 0;
        t += p * (item.qty || 1);
      });
      cartTransportation.forEach(item => {
        const p = parseFloat(String(item.price).replace(/[^\d.,]/g, '').replace(',', '.')) || 0;
        t += p * (item.qty || 1);
      });
      return t;
    }

    function hasAnyCartItems() {
      function hasItems(arr) {
        return arr.some(function(item) { return (item && (item.qty || 1) > 0); });
      }
      return hasItems(cartTickets) || hasItems(cartAccommodation) || hasItems(cartTransportation);
    }

    function makeAddBtn(ctaText, href) {
      return '<a class="empty-state-link" href="' + href + '">' + ctaText + '</a>';
    }

    function makeAddBtnAction(ctaText, onclick) {
      return '<button type="button" class="empty-state-link" onclick="' + onclick + '">' + ctaText + '</button>';
    }

    function render() {
      var ticketContainer = document.getElementById('ticket-items');
      var accomContainer = document.getElementById('accommodation-items');
      var transportContainer = document.getElementById('transportation-items');
      var ticketAddBtn = document.getElementById('ticket-add-btn');
      var accomAddBtn = document.getElementById('accommodation-add-btn');
      var transportAddBtn = document.getElementById('transportation-add-btn');
      ticketContainer.innerHTML = '';
      accomContainer.innerHTML = '';
      transportContainer.innerHTML = '';
      ticketAddBtn.innerHTML = '';
      accomAddBtn.innerHTML = '';
      transportAddBtn.innerHTML = '';
      cartTickets.forEach(function(item, i) { ticketContainer.appendChild(renderItem(item, i, 'tickets')); });
      cartAccommodation.forEach(function(item, i) { accomContainer.appendChild(renderItem(item, i, 'accommodation')); });
      cartTransportation.forEach(function(item, i) { transportContainer.appendChild(renderItem(item, i, 'transportation')); });
      if (cartTickets.length === 0) ticketAddBtn.innerHTML = makeAddBtn('Add passes', 'polar-sound.html#ticket-section');
      if (cartAccommodation.length === 0) accomAddBtn.innerHTML = makeAddBtnAction('Add hotel', 'openSheet(\"sheet-acc\")');
      if (cartTransportation.length === 0) transportAddBtn.innerHTML = makeAddBtnAction('Add transport', 'openSheet(\"sheet-transport\")');
      document.getElementById('cart-grand-total').textContent = '€' + getTotal().toFixed(2);
    }

    function initSwipe(container, inner, onDelete) {
      var startX = 0, startY = 0, currentX = 0, locked = false;
      inner.addEventListener('touchstart', function(e) {
        startX = e.touches[0].clientX;
        startY = e.touches[0].clientY;
        currentX = 0;
        locked = false;
        container.classList.add('active-swipe');
        inner.classList.add('swiping');
      }, { passive: true });
      inner.addEventListener('touchmove', function(e) {
        if (locked) return;
        var dx = e.touches[0].clientX - startX;
        var dy = e.touches[0].clientY - startY;
        if (Math.abs(dy) > Math.abs(dx) && currentX === 0) { locked = true; container.classList.remove('active-swipe'); return; }
        currentX = Math.min(0, dx);
        inner.style.transform = 'translateX(' + currentX + 'px)';
      }, { passive: true });
      inner.addEventListener('touchend', function() {
        inner.classList.remove('swiping');
        if (currentX < -80) {
          inner.style.transition = 'transform 0.25s ease';
          inner.style.transform = 'translateX(-100%)';
          setTimeout(function() { onDelete(); }, 250);
        } else {
          inner.style.transform = '';
          container.classList.remove('active-swipe');
        }
      });
    }

    // === BOTTOM SHEETS ===
    function openSheet(id) {
      document.getElementById('overlay-' + id).classList.add('open');
      document.getElementById(id).classList.add('open');
      document.body.style.overflow = 'hidden';
      if (id === 'sheet-acc') updateSheetAccBtn();
      if (id === 'sheet-transport') updateSheetTransportBtn();
    }
    function closeSheet(id) {
      var s = document.getElementById(id);
      if (s) s.style.transform = '';
      document.getElementById('overlay-' + id).classList.remove('open');
      if (s) s.classList.remove('open');
      document.body.style.overflow = '';
    }
    function resetSheetCounts(sheetId) {
      document.querySelectorAll('#' + sheetId + ' .sheet-row').forEach(function(row) {
        row.querySelector('.amt-count').textContent = '0';
        row.classList.remove('selected');
      });
    }

    document.getElementById('overlay-sheet-acc').addEventListener('click', function() { closeSheet('sheet-acc'); });
    document.getElementById('overlay-sheet-transport').addEventListener('click', function() { closeSheet('sheet-transport'); });
    document.getElementById('sheet-acc-close').addEventListener('click', function() { closeSheet('sheet-acc'); });
    document.getElementById('sheet-transport-close').addEventListener('click', function() { closeSheet('sheet-transport'); });

    function updateSheetAccBtn() {
      var totalQty = 0, totalPrice = 0;
      document.querySelectorAll('#sheet-acc .sheet-row').forEach(function(row) {
        var qty = parseInt(row.querySelector('.amt-count').textContent) || 0;
        var price = parseFloat(row.dataset.price) || 0;
        totalQty += qty;
        totalPrice += qty * price;
      });
      var btn = document.getElementById('sheet-acc-confirm');
      if (btn) btn.textContent = totalQty > 0 ? '\u20AC' + totalPrice.toFixed(2) + ' \u2014 Add it' : 'Skip hotel';
    }
    function updateSheetTransportBtn() {
      var totalQty = 0, totalPrice = 0;
      document.querySelectorAll('#sheet-transport .sheet-row').forEach(function(row) {
        var qty = parseInt(row.querySelector('.amt-count').textContent) || 0;
        var price = parseFloat(row.dataset.price) || 0;
        totalQty += qty;
        totalPrice += qty * price;
      });
      var btn = document.getElementById('sheet-transport-confirm');
      if (btn) btn.textContent = totalQty > 0 ? '\u20AC' + totalPrice.toFixed(2) + ' \u2014 Add it' : 'Skip transport';
    }
    function bindSheetSteppers(sheetId, updateBtn) {
      var sheet = document.getElementById(sheetId);
      if (!sheet) return;
      sheet.querySelectorAll('.sheet-row').forEach(function(row) {
        var minus = row.querySelector('.amt-btn.minus');
        var plus = row.querySelector('.amt-btn.plus');
        var countEl = row.querySelector('.amt-count');
        if (!countEl) return;
        plus.addEventListener('click', function(e) {
          e.stopPropagation();
          countEl.textContent = parseInt(countEl.textContent) + 1;
          row.classList.add('selected');
          if (typeof updateBtn === 'function') updateBtn();
        });
        minus.addEventListener('click', function(e) {
          e.stopPropagation();
          var val = parseInt(countEl.textContent);
          if (val > 0) {
            countEl.textContent = val - 1;
            row.classList.toggle('selected', parseInt(countEl.textContent) > 0);
            if (typeof updateBtn === 'function') updateBtn();
          }
        });
      });
    }
    bindSheetSteppers('sheet-acc', updateSheetAccBtn);
    bindSheetSteppers('sheet-transport', updateSheetTransportBtn);

    document.getElementById('sheet-acc-confirm').addEventListener('click', function() {
      var acc = [];
      document.querySelectorAll('#sheet-acc .sheet-row').forEach(function(row) {
        var qty = parseInt(row.querySelector('.amt-count').textContent);
        if (qty > 0) acc.push({ name: row.dataset.name, price: parseFloat(row.dataset.price), qty: qty });
      });
      localStorage.setItem('cart_accommodation', JSON.stringify(acc));
      closeSheet('sheet-acc');
      resetSheetCounts('sheet-acc');
      loadCart();
      render();
    });

    document.getElementById('sheet-transport-confirm').addEventListener('click', function() {
      var tr = [];
      document.querySelectorAll('#sheet-transport .sheet-row').forEach(function(row) {
        var qty = parseInt(row.querySelector('.amt-count').textContent);
        if (qty > 0) tr.push({ name: row.dataset.name, price: parseFloat(row.dataset.price), qty: qty });
      });
      localStorage.setItem('cart_transportation', JSON.stringify(tr));
      closeSheet('sheet-transport');
      resetSheetCounts('sheet-transport');
      loadCart();
      render();
    });

    // Swipe-to-dismiss for bottom sheets (touch + mouse)
    (function() {
      function enableSwipeDismiss(sheetEl, closeFn, baseTransform) {
        if (!sheetEl) return;
        var startY = 0, currentY = 0, isDragging = false;
        var base = baseTransform || '';
        function dragStart(y) { startY = y; currentY = y; isDragging = true; sheetEl.style.transition = 'none'; }
        function dragMove(y, e) { if (!isDragging) return; currentY = y; var dy = currentY - startY; if (dy < 0) dy = 0; if (dy > 0) { if (e) e.preventDefault(); sheetEl.style.transform = base + 'translateY(' + dy + 'px)'; } }
        function dragEnd() { if (!isDragging) return; isDragging = false; sheetEl.style.transition = ''; sheetEl.style.transform = ''; if (currentY - startY > 80) closeFn(); }
        sheetEl.addEventListener('touchstart', function(e) { var sc = sheetEl.querySelector('.sheet-content'); if (sc && sc.scrollTop > 0) return; dragStart(e.touches[0].clientY); }, { passive: true });
        sheetEl.addEventListener('touchmove', function(e) { dragMove(e.touches[0].clientY, e); }, { passive: false });
        sheetEl.addEventListener('touchend', dragEnd);
        sheetEl.addEventListener('mousedown', function(e) { var sc = sheetEl.querySelector('.sheet-content'); if (sc && sc.scrollTop > 0) return; e.preventDefault(); dragStart(e.clientY); });
        document.addEventListener('mousemove', function(e) { if (isDragging) dragMove(e.clientY, e); });
        document.addEventListener('mouseup', dragEnd);
      }
      enableSwipeDismiss(document.getElementById('sheet-acc'), function() { closeSheet('sheet-acc'); }, 'translateX(-50%) ');
      enableSwipeDismiss(document.getElementById('sheet-transport'), function() { closeSheet('sheet-transport'); }, 'translateX(-50%) ');
    })();

    loadCart();
    render();

    document.getElementById('btn-checkout').addEventListener('click', function() {
      if (!hasAnyCartItems()) {
        window.location.href = (window.flowHref||function(u){return u})('polar-sound.html#ticket-section');
        return;
      }
      try { sessionStorage.setItem('checkout_scroll_target', 'payment'); } catch (e) {}
      window.location.href = (window.flowHref||function(u){return u})('checkout.html');
    });
  </script>
  <script src="../../../js/flow-param.js"></script>
</body>
</html>
